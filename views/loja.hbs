<section class="shop">
  <div class="container shop-inner">
    <div class="shop-hero">
      <div class="shop-hero-top">
        <p class="shop-hero-title cart-highlight">LOJA OFICIAL</p>
        <div class="shop-oval"><img class="shop-oval-img" src="/public/img/loja/logoSTORE.png" alt="RC Store"/></div>
      </div>
    </div>

    <h2 class="shop-title">CAMISA OFICIAL<br/>2026 :D</h2>

  <div class="shop-product">
    <div class="shop-product-media">
      <img id="prodImg" class="shop-product-img" src="/public/img/loja/MODELOQUADRINHOSANTOSP&BBRANCAOVERSIZED.png" alt="Camisa oficial 2026"/>
      <div class="shop-thumbs">
        <button type="button" class="thumb-btn" data-src="/public/img/loja/FRENTEMODELOQUADRINHOSANTOSP&BBRANCAOVERSIZED.png">Frente</button>
        <button type="button" class="thumb-btn" data-src="/public/img/loja/MODELOQUADRINHOSANTOSP&BBRANCAOVERSIZED.png">Costas</button>
      </div>
    </div>
    <div class="shop-desc-row"><p class="shop-product-desc">Modelo quadrinho santos P&B - branca oversized</p><button type="button" class="desc-btn">Ver descri√ß√£o</button></div>
    <p class="shop-long-desc" hidden>T-SHIRT OVERSIZED  QUADRINHO SANTOS P&B: Elaborado em malha 100% algod√£o fio 30, t-shirt adulto. (unissex).</p>
    <div class="price-row">
      <p class="shop-product-price">R$68,00</p>
      <a class="add-to-cart" href="#" data-product-id="quadrinho_pb_branca">Adicionar ao carrinho</a>
    </div>
  </div>
  <div class="shop-product">
    <div class="shop-product-media">
      <img class="shop-product-img" src="/public/img/loja/MODELOQUADRINHOSANTOSP&B-BRANCA.png" alt="Camisa oficial 2026"/>
      <div class="shop-thumbs">
        <button type="button" class="thumb-btn" data-src="/public/img/loja/FRENTEMODELOQUADRINHOSANTOSP&B-BRANCA.png">Frente</button>
        <button type="button" class="thumb-btn" data-src="/public/img/loja/MODELOQUADRINHOSANTOSP&B-BRANCA.png">Costas</button>
      </div>
    </div>
    <div class="shop-desc-row"><p class="shop-product-desc">Modelo quadrinho santos P&B - branca regular</p><button type="button" class="desc-btn">Ver descri√ß√£o</button></div>
    <p class="shop-long-desc" hidden>Elaborado em malha 100% algod√£o fio 30, t-shirt adulto. (unissex);</p>
    <div class="price-row">
      <p class="shop-product-price">R$52,00</p>
      <a class="add-to-cart" href="#" data-product-id="quadrinho_pb_branca_regular">Adicionar ao carrinho</a>
    </div>
  </div>
  <div class="shop-product">
    <div class="shop-product-media">
      <img class="shop-product-img" src="/public/img/loja/MODELOQUADRINHOSANTOSCOLOR-PRETA OVERSIZED.png" alt="Camisa oficial 2026"/>
      <div class="shop-thumbs">
        <button type="button" class="thumb-btn" data-src="/public/img/loja/FRENTEMODELOQUADRINHOSANTOSCOLOR-PRETAOVERSIZED .png">Frente</button>
        <button type="button" class="thumb-btn" data-src="/public/img/loja/MODELOQUADRINHOSANTOSCOLOR-PRETA OVERSIZED.png">Costas</button>
      </div>
    </div>
    <div class="shop-desc-row"><p class="shop-product-desc">Modelo quadrinho santos color - preta oversized</p><button type="button" class="desc-btn">Ver descri√ß√£o</button></div>
    <p class="shop-long-desc" hidden>T-SHIRT OVERSIZED  QUADRINHO SANTOS P&B: Elaborado em malha 100% algod√£o fio 30, t-shirt adulto. (unissex).</p>
    <div class="price-row">
      <p class="shop-product-price">R$68,00</p>
      <a class="add-to-cart" href="#" data-product-id="quadrinho_color_preta">Adicionar ao carrinho</a>
    </div>
  </div>
  <div class="shop-product">
    <div class="shop-product-media">
      <img class="shop-product-img" src="/public/img/loja/MODELOQUADRINHOSANTOSCOLORPRETA.png" alt="Camisa oficial 2026"/>
      <div class="shop-thumbs">
        <button type="button" class="thumb-btn" data-src="/public/img/loja/FRENTEMODELOQUADRINHOSANTOSCOLORPRETA.png">Frente</button>
        <button type="button" class="thumb-btn" data-src="/public/img/loja/MODELOQUADRINHOSANTOSCOLORPRETA.png">Costas</button>
      </div>
    </div>
    <div class="shop-desc-row"><p class="shop-product-desc">Modelo quadrinho santos color - preta regular</p><button type="button" class="desc-btn">Ver descri√ß√£o</button></div>
    <p class="shop-long-desc" hidden>Elaborado em malha 100% algod√£o fio 30, t-shirt adulto. (unissex);</p>
    <div class="price-row">
      <p class="shop-product-price">R$52,00</p>
      <a class="add-to-cart" href="#" data-product-id="quadrinho_color_preta_regular">Adicionar ao carrinho</a>
    </div>
  </div>
  <div class="shop-product">
    <div class="shop-product-media">
      <img class="shop-product-img" src="/public/img/loja/cordao.jpeg" alt="Cord√£o Alfa&√îmega"/>
    </div>
    <div class="shop-desc-row"><p class="shop-product-desc">Cord√£o Alfa&√îmega</p><button type="button" class="desc-btn">Ver descri√ß√£o</button></div>
    <p class="shop-long-desc" hidden>Medalha em acr√≠lico preto, fio acetinado (calda de rato). Pingente 4cm por 4cm.</p>
    <div class="price-row">
      <p class="shop-product-price">R$12,00</p>
      <a class="add-to-cart" href="#" data-product-id="cordao_alfa_omega">Adicionar ao carrinho</a>
    </div>
  </div>
  </div>
</section>

<div class="cart-fab" role="group" aria-label="Carrinho">
  <a href="/carrinho" class="cart-fab-btn" aria-label="Abrir carrinho">
    <span class="shop-bag">üõí</span>
    <span class="cart-fab-text">Carrinho</span>
    <span class="cart-badge" id="cartBadge" hidden>0</span>
  </a>
  </div>

<script>
 (function(){
  document.querySelectorAll('.shop-product').forEach(prod => {
    const base = prod.querySelector('.shop-product-img');
    prod.querySelectorAll('.thumb-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const src = btn.getAttribute('data-src');
        if (!base || !src) return;
        if (base.getAttribute('src') === src) return;
        base.setAttribute('src', src);
      });
    });
    const descBtn = prod.querySelector('.desc-btn');
    const longDesc = prod.querySelector('.shop-long-desc');
    if (descBtn && longDesc) {
      descBtn.addEventListener('click', () => {
        const hidden = longDesc.hasAttribute('hidden');
        if (hidden) { longDesc.removeAttribute('hidden'); descBtn.textContent = 'Ocultar descri√ß√£o'; }
        else { longDesc.setAttribute('hidden',''); descBtn.textContent = 'Ver descri√ß√£o'; }
      });
    }
    const btnBuy = prod.querySelector('.add-to-cart');
    if (btnBuy) {
      btnBuy.addEventListener('click', async (e) => {
        e.preventDefault();
        if (btnBuy.disabled) return;
        btnBuy.disabled = true;
        const prevText = btnBuy.textContent;
        btnBuy.textContent = 'Adicionando...';
        const product_id = btnBuy.getAttribute('data-product-id');
        const qtyEl = prod.querySelector('.qty-input');
        const size = product_id === 'cordao_alfa_omega' ? 'U' : 'M';
        const qty = qtyEl ? qtyEl.value : '1';
        try {
          const r = await fetch('/cart/add', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ product_id, size, qty }) });
          const data = await r.json();
          if (r.status === 401) { window.location.href = data.loginUrl || '/login?next=/carrinho'; return; }
          if (data.ok && data.redirect) { window.location.href = data.redirect; }
        } catch {}
        finally { btnBuy.disabled = false; btnBuy.textContent = prevText; }
      });
    }
  });
  async function refreshCartBadge(){
    try{
      const r = await fetch('/cart/count');
      const data = await r.json();
      const b = document.getElementById('cartBadge');
      if (!b) return;
      const n = Number(data.count || 0);
      if (n > 0) { b.textContent = String(n); b.hidden = false; }
      else { b.hidden = true; }
    }catch{}
  }
  refreshCartBadge();
})();
</script>
